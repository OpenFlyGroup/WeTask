#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ Prisma Client —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –ø–æ–ø—ã—Ç–∫–∞–º–∏

set -e

echo "üîß –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Prisma Client..."

# –ü–æ–ø—ã—Ç–∫–∞ 1: –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
if npx prisma generate 2>/dev/null; then
    echo "‚úÖ Prisma Client —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω —É—Å–ø–µ—à–Ω–æ!"
    exit 0
fi

echo "‚ö†Ô∏è  –ü–µ—Ä–≤–∞—è –ø–æ–ø—ã—Ç–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å, –ø—Ä–æ–±—É–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã..."

# –ü–æ–ø—ã—Ç–∫–∞ 2: –° –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –∑–µ—Ä–∫–∞–ª–∞
if PRISMA_ENGINES_MIRROR=https://binaries.prisma.sh npx prisma generate 2>/dev/null; then
    echo "‚úÖ Prisma Client —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω —á–µ—Ä–µ–∑ –∑–µ—Ä–∫–∞–ª–æ!"
    exit 0
fi

# –ü–æ–ø—ã—Ç–∫–∞ 3: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Prisma –ª–æ–∫–∞–ª—å–Ω–æ –∏ –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞
echo "üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Prisma –ª–æ–∫–∞–ª—å–Ω–æ..."
pnpm add -D prisma @prisma/client 2>/dev/null || true

if npx prisma generate 2>/dev/null; then
    echo "‚úÖ Prisma Client —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –ø–æ—Å–ª–µ –ª–æ–∫–∞–ª—å–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏!"
    exit 0
fi

echo "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å Prisma Client –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏"
echo ""
echo "üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:"
echo "   1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ"
echo "   2. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å VPN (–µ—Å–ª–∏ –∑–∞ —Ñ–∞–π—Ä–≤–æ–ª–æ–º)"
echo "   3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Node.js LTS (v20 –∏–ª–∏ v22) –≤–º–µ—Å—Ç–æ v23"
echo "   4. –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Docker –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:"
echo "      docker run --rm -v \$(pwd):/app -w /app node:20-alpine sh -c 'npm install && npx prisma generate'"
echo ""
echo "üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ —á–µ—Ä–µ–∑ SQL —Å–∫—Ä–∏–ø—Ç"
echo "   –í—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É, –Ω–æ Prisma Client –Ω—É–∂–µ–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å–µ—Ä–≤–∏—Å–æ–≤"

exit 1

